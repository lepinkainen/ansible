#!/bin/bash

# Colors for output
RED='\033[0;31m'
YELLOW='\033[1;33m'
GREEN='\033[0;32m'
NC='\033[0m' # No Color

echo "=== Disk Usage ==="

# Function to get disk info and format it
show_disk_usage() {
    local mount_point=$1
    local df_output=$(df -h "$mount_point" | tail -n 1)

    # Extract values using awk
    local filesystem=$(echo "$df_output" | awk '{print $1}')
    local size=$(echo "$df_output" | awk '{print $2}')
    local used=$(echo "$df_output" | awk '{print $3}')
    local avail=$(echo "$df_output" | awk '{print $4}')
    local use_percent=$(echo "$df_output" | awk '{print $5}' | tr -d '%')

    # Determine color based on usage percentage
    local color=$GREEN
    if [ "$use_percent" -ge 90 ]; then
        color=$RED
    elif [ "$use_percent" -ge 75 ]; then
        color=$YELLOW
    fi

    # Format the output
    printf "  %-10s ${color}%3s%%${NC} used  %4s / %4s  (%4s free)\n" \
           "$mount_point" "$use_percent" "$used" "$size" "$avail"
}

# Show disk usage for configured locations
{% for location in disk_usage_locations | default(['/']) %}
show_disk_usage "{{ location }}"
{% endfor %}

echo
