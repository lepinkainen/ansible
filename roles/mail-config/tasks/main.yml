---
- name: Install ssmtp
  apt:
    name: ssmtp
    state: present
  tags: [mail, security, install]

- name: Configure ssmtp
  template:
    src: ssmtp.conf.j2
    dest: /etc/ssmtp/ssmtp.conf
    backup: yes
    mode: '0644'
  tags: [mail, security, config]

- name: Configure apt-listchanges to use ssmtp
  lineinfile:
    path: /etc/apt/listchanges.conf
    regexp: '^#?frontend='
    line: 'frontend=mail'
    backup: yes
  tags: [mail, security, config]

- name: Set apt-listchanges email method to use sendmail (ssmtp)
  lineinfile:
    path: /etc/apt/listchanges.conf
    regexp: '^#?email_address='
    line: 'email_address=root'
    backup: yes
  tags: [mail, security, config]

- name: Ensure apt-listchanges uses the correct mail command
  lineinfile:
    path: /etc/apt/listchanges.conf
    regexp: '^#?which='
    line: 'which=both'
    backup: yes
  tags: [mail, security, config]