---
- name: "Set hostname to {{ hostname }}"
  hostname:
    name: "{{ hostname }}"
  when: hostname != ansible_hostname
  tags: [system-basics, system, config]

- name: Add hostname to /etc/hosts
  lineinfile:
    path: /etc/hosts
    regexp: '^127\.0\.1\.1'
    line: "127.0.1.1 {{ hostname }}"
    backup: yes
  tags: [system-basics, system, config]

- name: Generate locales
  locale_gen:
    name: "{{ item }}"
    state: present
  loop: "{{ locales }}"
  tags: [system-basics, system, config]

- name: Set timezone
  timezone:
    name: "{{ timezone }}"
  tags: [system-basics, system, config]

- name: Configure timezone file
  copy:
    content: "{{ timezone }}\n"
    dest: /etc/timezone
    backup: yes
  notify: reconfigure tzdata
  tags: [system-basics, system, config]

- name: Update apt cache
  apt:
    update_cache: yes
    cache_valid_time: 3600
  tags: [system-basics, system]